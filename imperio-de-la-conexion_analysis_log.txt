An√°lisis del Proyecto: imperio-de-la-conexion

========================================
üìÅ Carpeta: ././
========================================

    üìÑ Archivo: README.md
    ---------- CONTENIDO ----------
    # üåê Imperio de la Conexi√≥n
    
    Un juego incremental (idle/clicker) donde construyes un imperio de telecomunicaciones desde cero, comenzando en la vibrante era de los a√±os 80.
    
    **‚ú® https://imperio-de-la-conexion.vercel.app/ ‚ú®**
    
    ---
    
    ## üìú Concepto del Juego
    
    Es la d√©cada de los 80. Los tel√©fonos son de disco y las conexiones, un lujo. En un garaje lleno de sue√±os y circuitos, fundas una peque√±a empresa con una visi√≥n audaz: conectar al mundo.
    
    Tu objetivo es evolucionar tu tecnolog√≠a, expandir tu infraestructura y generar ingresos, avanzando a trav√©s de las diferentes eras de la revoluci√≥n digital, desde las l√≠neas de cobre y los m√≥dems de 2400 baudios hasta la fibra √≥ptica y m√°s all√°.
    
    ## üöÄ Caracter√≠sticas Principales
    
    *   **Progresi√≥n por Eras:** Comienza en los 80 y avanza a trav√©s de d√©cadas de innovaci√≥n tecnol√≥gica.
    *   **Mejoras Tem√°ticas:** Todas las mejoras est√°n basadas en tecnolog√≠as reales e ic√≥nicas de cada √©poca.
    *   **Mec√°nica de Prestigio:** Utiliza los "Puntos de Innovaci√≥n" para relanzar tu imperio con bonificaciones permanentes.
    *   **Guardado Local:** Tu progreso se guarda autom√°ticamente en tu navegador usando `localStorage`.
    *   **Est√©tica Retro:** La interfaz, las fuentes y los efectos de sonido est√°n dise√±ados para evocar la nostalgia de los monitores CRT y las primeras terminales.
    
    ## üíª Pila Tecnol√≥gica
    
    Este proyecto est√° construido con tecnolog√≠a web fundamental, sin necesidad de frameworks complejos:
    
    *   **HTML5:** Para la estructura del contenido.
    *   **CSS3:** Para los estilos, animaciones y el dise√±o responsivo (utilizando Flexbox y Grid).
    *   **JavaScript (ES6):** Para toda la l√≥gica del juego, c√°lculos y manipulaci√≥n del DOM.
    *   **Howler.js:** Una biblioteca de audio para un manejo sencillo y robusto de los efectos de sonido y la m√∫sica.
    
    ## ‚ñ∂Ô∏è C√≥mo Jugar Localmente
    
    1.  Clona este repositorio en tu m√°quina local.
    2.  Abre el archivo `index.html` directamente en tu navegador web preferido (Chrome, Firefox, etc.).
    3.  ¬°A jugar!
    
    ---
    *Un proyecto de ClanHater.*
    ---------- FIN CONTENIDO ----------

    üìÑ Archivo: git
    ---------- CONTENIDO ----------

    ---------- FIN CONTENIDO ----------

    üìÑ Archivo: index.html
    ---------- CONTENIDO ----------
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Imperio de la Conexi√≥n</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
    	<link rel="stylesheet" href="css/animations.css">
    	<link rel="stylesheet" href="css/icons.css">
    	<link rel="stylesheet" id="era-style" href="css/eras/era-1g.css"> 
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    </head>
    <body>
        <!-- PANTALLA DE CARGA -->
        <div id="loading-screen" class="full-screen">
            <div class="loading-content">
                <p>ClanHater presenta...</p>
                <div class="loader"></div>
            </div>
        </div>
    
        <!-- PANTALLA "TOCA PARA EMPEZAR" -->
        <div id="tap-to-start-screen" class="full-screen menu-background hidden">
            <div class="title-content">
                <h1>Imperio de la Conexi√≥n</h1>
                <p class="blink">Toca para empezar</p>
            </div>
        </div>
    
        <!-- MEN√ö PRINCIPAL -->
        <div id="main-menu-screen" class="full-screen menu-background hidden">
            <nav class="main-menu">
                <button id="play-button" class="menu-button">Jugar</button>
                <button id="story-button" class="menu-button">Historia</button>
                <button id="options-button-menu" class="menu-button">Opciones</button>
                <button id="credits-button" class="menu-button">Cr√©ditos</button>
            </nav>
        </div>
    
        <!-- PANTALLA DE HISTORIA -->
        <div id="story-screen" class="full-screen menu-background hidden">
            <div class="panel">
                <h2>El Amanecer de la Conexi√≥n</h2>
                <p>Es la d√©cada de los 80. Los tel√©fonos son de disco y las conexiones, un lujo. En un garaje lleno de sue√±os y circuitos, fundas una peque√±a empresa con una visi√≥n audaz: conectar al mundo. Empiezas con una simple l√≠nea de cobre, pero tu ambici√≥n es tejer una red que abarque el planeta, evolucionando con cada nueva generaci√≥n tecnol√≥gica.</p>
                <button class="back-button">Volver</button>
            </div>
        </div>
        
        <!-- PANTALLA DE OPCIONES -->
        <div id="options-screen" class="full-screen menu-background hidden">
            <div class="panel">
                <h2>Opciones</h2>
                <div class="option-item">
                    <label for="master-volume">Volumen General</label>
                    <input type="range" id="master-volume" min="0" max="1" step="0.05">
                </div>
                <div class="option-item">
                    <label>Borrar Progreso</label>
                    <button id="reset-save-button" class="danger-button">Borrar Guardado</button>
                </div>
                <button class="back-button">Volver</button>
            </div>
        </div>
    
        <!-- PANTALLA DE CR√âDITOS -->
        <div id="credits-screen" class="full-screen menu-background hidden">
            <div class="credits-container">
                <div class="credits-content">
                    <h3>Imperio de la Conexi√≥n</h3>
                    <p>Un Juego de ClanHater</p><br>
                    <h4>-- Desarrollo Principal --</h4><p>ClanHater</p><br>
                    <h4>-- Control de Calidad y Depuraci√≥n --</h4><p>ClanHater</p><br>
                    <h4>-- Activos de Sonido --</h4><p>Pixabay</p><br>
                    <h4>-- Activos Visuales --</h4><p>Nanobanana & Google Fonts</p><br>
                    <p>Gracias por jugar y por ayudar a conectar este peque√±o mundo digital.</p><br>
                    <p>...Se han transmitido 0 terabytes de datos de gatitos durante la creaci√≥n de este juego...</p><br>
                    <p>...Ning√∫n teclado fue da√±ado en el proceso...</p>
                </div>
            </div>
            <button class="back-button credits-back-button">Volver</button>
        </div>
    
        <!-- ===== ESTA ES LA PARTE RESTAURADA ===== -->
        <div id="game-container" class="game-container hidden">
    
    		<!-- (1) BARRA SUPERIOR (Nueva) -->
    		<header class="top-bar">
    			<div class="resource-display">
    				<h1 id="money-display">$0</h1>
    				<p id="dps-display">+$0 / seg</p>
    			</div>
    			<div id="top-shortcut-bar" class="top-shortcut-bar"> <!-- ID y Clase Nuevos -->
    				<button id="menu-button-shortcut" class="shortcut-btn"><i class="icon-menu-back"></i></button> 
    				<button class="shortcut-btn"><i class="icon-store"></i></button> <!-- Clase Nueva -->
    				<button class="shortcut-btn"><i class="icon-achievements"></i></button> <!-- Clase Nueva -->
    				<button class="shortcut-btn"><i class="icon-missions"></i></button> <!-- Clase Nueva -->
    			</div>
    		</header>
    
    		<!-- (2) CONTENIDO DE LAS PESTA√ëAS (Nuevo) -->
    		<main class="tab-content">
    
    			<!-- Pesta√±a Principal (Juego) -->
    			<div id="main-tab" class="tab-panel active">
    				<div id="main-tab-background"></div>
    				<div class="terminal-header">
    					<p>IDC_OS v1.0 - [Imperio de la Conexi√≥n]</p>
    					<p>ESTADO DE LA RED: <span class="status-online blink">EN L√çNEA</span></p>
    				</div>
    				<div class="prestige-info-top">
    					<p id="prestige-points-display">Puntos de Innovaci√≥n: 0 (+0%)</p>
    				</div>
    				<div class="main-click-area">
    					<button id="main-click-button" class="main-click-button">
    						<div class="icon">üåê</div>
    						<span>Establecer<br>Conexi√≥n</span>
    						<small id="dpc-display">Ancho de Banda: +$1/conexi√≥n</small>
    					</button>
    				</div>
    			</div>
    
    			<!-- Pesta√±a Mejoras -->
    			<div id="upgrades-tab" class="tab-panel">
    				<div id="upgrades-container">
    					<!-- Las mejoras se siguen generando aqu√≠ -->
    				</div>
    			</div>
    
    			<!-- Pesta√±a Evoluci√≥n -->
    			<div id="evolution-tab" class="tab-panel">
    				<div class="evolution-content">
    					<h2>Evoluci√≥n Tecnol√≥gica</h2>
    					<div class="current-era">
    						<h3>ERA ACTUAL: 1G - Los Inicios</h3>
    						<p>La era de la telefon√≠a anal√≥gica y las conexiones conmutadas. ¬°El primer paso hacia un mundo conectado!</p>
    					</div>
    					<button id="relaunch-button" class="relaunch-button-styled">Relanzar</button>
    				</div>
    			</div>
    
    		</main>
        
    		<!-- PANTALLA "PR√ìXIMAMENTE" (Nueva y oculta) -->
    		<div id="coming-soon-popup" class="panel coming-soon-panel">
    			<h2>Pr√≥ximamente</h2>
    			<p>¬°Esta funci√≥n est√° en desarrollo! Vuelve m√°s tarde para descubrir nuevas formas de expandir tu imperio.</p>
    			<button id="close-popup-button">Cerrar</button>
    		</div>
    
    
    		<!-- (3) BARRA DE NAVEGACI√ìN INFERIOR (Nueva) -->
    		<nav id="game-tab-bar" class="game-tab-bar"> <!-- ID y Clase Nuevos -->
    			<button class="tab-btn" data-tab="upgrades-tab"> <!-- Clase Nueva -->
    				<i class="icon-upgrades"></i><span>Mejoras</span>
    			</button>
    			<button class="tab-btn main-nav-button active" data-tab="main-tab"> <!-- Clase Nueva -->
    				<i class="icon-main"></i>
    			</button>
    			<button class="tab-btn" data-tab="evolution-tab"> <!-- Clase Nueva -->
    				<i class="icon-evolution"></i><span>Evoluci√≥n</span>
    			</button>
    		</nav>
        
    	</div>
    
    	<script src="js/audio.js"></script>
    	<script src="js/ui.js"></script>
        <script src="js/main.js"></script>
    </body>
    </html>
    ---------- FIN CONTENIDO ----------


    ========================================
    üìÅ Carpeta: ./css/
    ========================================

        üìÑ Archivo: animations.css
        ---------- CONTENIDO ----------
        /* ---- ANIMACI√ìN DE N√öMEROS FLOTANTES ---- */
        
        /* Define la animaci√≥n: empieza opaco, se mueve hacia arriba y se desvanece */
        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }
        
        /* Estilo para los n√∫meros que crearemos con JavaScript */
        .floating-number {
            position: absolute; /* Permite posicionarlo donde ocurri√≥ el clic */
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            color: #84FFC9; /* Color del dinero */
            text-shadow: 0 0 5px #fff;
            pointer-events: none; /* Asegura que el n√∫mero no interfiera con los clics */
            animation: float-up 1s ease-out forwards;
        }
        
        /* ---- ANIMACI√ìN DE BOT√ìN DISPONIBLE ---- */
        
        /* Define la animaci√≥n: un pulso de brillo sutil */
        @keyframes glow {
            0% {
                box-shadow: 0 0 5px #00F5D4, 0 0 10px #00F5D4 inset;
            }
            50% {
                box-shadow: 0 0 15px #00F5D4, 0 0 20px #00F5D4 inset;
            }
            100% {
                box-shadow: 0 0 5px #00F5D4, 0 0 10px #00F5D4 inset;
            }
        }
        
        /* Clase que aplicaremos con JavaScript a los botones de compra */
        .can-afford-glow {
            animation: glow 2s infinite;
        }
        ---------- FIN CONTENIDO ----------

        üìÑ Archivo: icons.css
        ---------- CONTENIDO ----------
        /* En css/icons.css (Archivo Completo) */
        
        [class^="icon-"] {
            display: inline-block;
            position: relative;
            vertical-align: middle;
            width: 24px;
            height: 24px;
            color: currentColor; /* Hereda el color del bot√≥n */
        }
        
        /* --- Iconos Barra Superior --- */
        /* Resetea el estilo del bot√≥n contenedor para hacerlo invisible */
        .top-shortcut-bar .shortcut-btn {
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
        }
        
        .top-shortcut-bar .shortcut-btn i {
            display: flex;
            justify-content: center;
            align-items: center;
            font-style: normal; /* Necesario para que los emojis se vean bien */
        }
        
        .icon-store::before { content: 'üõí'; font-size: 20px; }
        .icon-achievements::before { content: 'üèÜ'; font-size: 20px; }
        .icon-missions::before { content: 'üìã'; font-size: 20px; }
        .icon-menu-back::before { content: 'üè†'; font-size: 20px; }
        
        /* --- Iconos Barra Inferior --- */
        .icon-main {
            width: 50px; height: 50px;
            background: radial-gradient(circle, #FF00A8, #8A2BE2);
            border-radius: 50%;
            border: 3px solid #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute; /* Para sacarlo del flujo */
            top: -25px; /* Lo sube para que sobresalga */
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px #FF00A8;
        }
        .icon-main::before { content: '‚ö°'; font-size: 24px; color: #fff; text-shadow: 0 0 5px #fff; }
        .tab-btn.active .icon-main { transform: translateX(-50%) scale(1.1); }
        
        .icon-upgrades::before, .icon-upgrades::after { content:''; position: absolute; }
        .icon-upgrades::before { border-left: 12px solid transparent; border-right: 12px solid transparent; border-bottom: 16px solid currentColor; top: 4px; }
        .icon-upgrades::after { width: 8px; height: 8px; background: currentColor; border-radius: 2px; top: 11px; left: 8px; }
        
        .icon-evolution::before, .icon-evolution::after { content:''; position: absolute; border: 2px solid currentColor; border-radius: 50%; }
        .icon-evolution::before { width: 10px; height: 10px; top: 2px; left: 5px; }
        .icon-evolution::after { width: 18px; height: 18px; top: -2px; left: 1px; }
        ---------- FIN CONTENIDO ----------

        üìÑ Archivo: style.css
        ---------- CONTENIDO ----------
        /* ---- RESET Y ESTILOS GLOBALES ---- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'VT323', monospace; 
            background-color: #0D0221; 
            color: #F2E9F4; /* Color de fallback */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-size: 18px; 
            user-select: none; 
        }
        
        /* 
        ==================================================================
           ESTILOS PARA LA SECUENCIA DE INICIO Y MEN√öS (PANTALLAS COMPLETAS)
        ==================================================================
        */
        .full-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0D0221; z-index: 200; display: flex; justify-content: center; align-items: center; text-align: center; color: #F2E9F4; }
        .hidden { display: none !important; }
        .loading-content { animation: fadeIn 1.5s ease-in-out; }
        .loading-content.fade-out { animation: fadeOut 1.5s ease-in-out forwards; }
        .loading-content p { font-size: 1.5rem; color: #00F5D4; margin-bottom: 20px; text-shadow: 0 0 5px #00F5D4; }
        .loader { border: 8px solid #2A1B3D; border-top: 8px solid #00F5D4; border-radius: 50%; width: 60px; height: 60px; animation: spin 1.5s linear infinite; margin: 0 auto; }
        .menu-background { background-image: url('../assets/images/title-background.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; cursor: default; }
        .menu-background::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1; }
        #tap-to-start-screen { cursor: pointer; }
        .title-content, .main-menu, .panel, .credits-container { position: relative; z-index: 2; }
        .title-content h1 { font-family: 'Press Start 2P', cursive; font-size: 2.5rem; color: #FF00A8; text-shadow: 0 0 10px #FF00A8, 0 0 5px #fff; margin-bottom: 40px; }
        .title-content .blink { font-size: 1.8rem; animation: blink 1.5s linear infinite; }
        .main-menu { display: flex; flex-direction: column; gap: 20px; width: 250px; }
        .menu-button { padding: 15px; background-color: transparent; color: #00F5D4; border: 3px solid #00F5D4; border-radius: 5px; cursor: pointer; font-family: 'Press Start 2P', cursive; font-size: 1.5rem; text-shadow: 0 0 5px #00F5D4; transition: all 0.2s ease; }
        .menu-button:hover { background-color: #00F5D4; color: #0D0221; box-shadow: 0 0 15px #00F5D4; }
        .panel { width: 90%; max-width: 420px; background-color: rgba(13, 2, 33, 0.85); border: 3px solid #FF00A8; padding: 25px; text-align: center; }
        .panel h2 { font-family: 'Press Start 2P', cursive; color: #00F5D4; margin-bottom: 30px; }
        .panel p { font-size: 1.2rem; line-height: 1.5; margin-bottom: 30px; }
        .option-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; font-size: 1.3rem; }
        input[type="range"] { width: 50%; }
        .back-button, #close-popup-button {
            padding: 10px 20px;
            font-size: 1.2rem;
            background-color: #555;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        .danger-button { background-color: #D32F2F; color: white; border: none; padding: 10px 15px; font-size: 1.1rem; cursor: pointer; }
        .credits-container { width: 100%; height: 80%; overflow: hidden; }
        .credits-content { position: absolute; width: 100%; text-align: center; font-size: 1.2rem; animation: scroll-credits 20s linear infinite; }
        .credits-content h3 { font-family: 'Press Start 2P'; font-size: 1.5rem; color: #00F5D4; margin-bottom: 20px;}
        .credits-content h4 { color: #FF00A8; margin-top: 20px; margin-bottom: 5px; }
        .credits-back-button { position: absolute; bottom: 20px; z-index: 5; }
        
        /* 
        ==================================================================
           ESTRUCTURA BASE DE LA PANTALLA DE JUEGO (SIN ESTILOS DE ERA)
        ==================================================================
        */
        
        .game-container { 
            width: 100%; 
            max-width: 480px; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            /* Todos los estilos de color, borde y sombra han sido eliminados */
        }
        
        /* --- Barra Superior del Juego --- */
        .top-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px 15px; 
            flex-shrink: 0; 
            /* Estilos de era eliminados */
        }
        .resource-display {
        	font-family: 'Press Start 2P', cursive;
        	min-width: 0; 
            /* Estilos de era eliminados */
        }
        #money-display { 
            font-size: 1rem; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            /* Estilos de era eliminados */
        }
        #dps-display { 
            font-size: 0.7rem; 
            margin-top: 5px; 
            /* Estilos de era eliminados */
        }
        .top-shortcut-bar { display: flex; align-items: center; gap: 15px; }
        .icon-button { background: transparent; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; }
        
        /* --- Contenido de las Pesta√±as del Juego --- */
        .tab-content { flex: 1; overflow: hidden; position: relative; min-height: 0; }
        .tab-panel { 
            display: none; 
            padding: 15px; 
            height: 100%; 
            overflow-y: auto; 
            /* Estilos de era eliminados */
        }
        .tab-panel.active { display: flex; flex-direction: column; } 
        
        /* Pesta√±a Principal */
        .prestige-info-top { 
            text-align: center; 
            font-size: 1rem; 
            padding: 5px; 
            flex-shrink: 0; 
            /* Estilos de era eliminados */
        }
        .main-click-area { 
            flex-grow: 1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            position: relative; 
        }
        .main-click-button { 
            width: 180px; 
            height: 180px; 
            border-radius: 50%; 
            color: white; 
            cursor: pointer; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            transition: all 0.1s ease; 
            font-family: 'Press Start 2P', cursive; 
            font-size: 1.2rem; 
            /* Estilos de era eliminados */
        }
        .main-click-button:active { transform: scale(0.95); /* Estilos de era eliminados */ }
        .main-click-button .icon { font-size: 3rem; }
        .main-click-button small { font-size: 0.7rem; margin-top: 8px; font-family: 'VT323', monospace; /* Estilos de era eliminados */ }
        .terminal-header {
            font-family: 'VT323', monospace;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 15px; 
            /* Estilos de era eliminados */
        }
        .terminal-header p {
            margin: 0;
            font-size: 1rem;
            line-height: 1.4;
        }
        .terminal-header .status-online {
            font-weight: bold;
            /* Estilos de era eliminados */
        }
        #main-tab {
            position: relative;
            overflow: hidden; 
        }
        
        /* El lienzo de nuestro fondo animado (SOLO ESTRUCTURA) */
        #main-tab-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; 
            /* Estilos de era (color, imagen, animaci√≥n) eliminados */
        }
        
        /* Efecto de l√≠neas de escaneo de monitor CRT antiguo (SOLO ESTRUCTURA) */
        #main-tab-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Estilos de era (background-image, opacity) eliminados */
        }
        
        /* Definici√≥n de la animaci√≥n */
        @keyframes scroll-grid {
            from { background-position: 0 0; }
            to { background-position: 0 -200px; } 
        }
        
        /* Aseguramos que el contenido principal est√© por encima del fondo */
        .terminal-header, .prestige-info-top, .main-click-area {
            position: relative;
            z-index: 1;
        }
        
        /* Pesta√±a Mejoras */
        #upgrades-container {
            display: flex;
            flex-direction: column;
            gap: 6px; 
        }
        
        /* Contenedor Principal de la Mejora */
        .upgrade {
            display: grid; 
            grid-template-columns: auto 1fr auto; 
            align-items: center;
            gap: 12px; 
            /* Estilos de era eliminados */
            transition: background-color 0.2s ease;
        }
        .upgrade:hover {
            /* Estilos de era eliminados */
        }
        
        /* Icono (ya no necesita margen) */
        .upgrade-icon {
            font-size: 1.8rem;
            flex-shrink: 0; 
        }
        
        /* Secci√≥n de Informaci√≥n */
        .upgrade-info {
            min-width: 0; 
        }
        .upgrade-info h4 {
            margin: 0 0 2px 0;
            font-size: 1rem;
        }
        .upgrade-info p {
            margin: 0;
            font-size: 0.85rem;
            line-height: 1.2;
            /* Estilos de era eliminados */
        }
        
        /* Bot√≥n de Compra */
        .buy-button {
            padding: 10px 12px; 
            background-color: transparent;
            cursor: pointer;
            font-family: 'VT323', monospace; 
            font-size: 1rem; 
            text-align: center;
            transition: all 0.2s ease;
            flex-shrink: 0; 
            white-space: nowrap; 
            /* Estilos de era eliminados */
        }
        .buy-button:not(.is-disabled):hover {
            /* Estilos de era eliminados */
        }
        .buy-button.is-disabled {
            cursor: not-allowed;
            opacity: 0.6;
            /* Estilos de era eliminados */
        }
        
        /* Pesta√±a Evoluci√≥n */
        .evolution-content { text-align: center; padding-top: 20px; }
        .evolution-content h2 { font-family: 'Press Start 2P'; /* Estilos de era eliminados */ }
        .current-era { 
            padding: 20px; 
            margin: 30px 0; 
            /* Estilos de era eliminados */
        }
        .current-era h3 { margin-bottom: 10px; }
        .relaunch-button-styled { 
            padding: 15px; 
            background-color: transparent; 
            cursor: pointer; 
            font-family: 'Press Start 2P', cursive; 
            font-size: 1.2rem; 
            transition: all 0.2s ease; 
            /* Estilos de era eliminados */
        }
        .relaunch-button-styled:not(.is-disabled):hover { 
            /* Estilos de era eliminados */
        }
        .relaunch-button-styled.is-disabled { 
            cursor: not-allowed; 
            /* Estilos de era eliminados */
        }
        
        /* --- Pop-up "Pr√≥ximamente" --- */
        .coming-soon-panel {
            display: none; 
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 101; 
        }
        .game-container.popup-visible .coming-soon-panel {
            display: block;
        }
        
        /* Opcional: Fondo oscuro para el pop-up */
        .game-container.popup-visible::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
        }
        
        /* --- Barra de Navegaci√≥n Inferior (NUEVO DISE√ëO) --- */
        .game-tab-bar { 
            display: grid; 
            grid-template-columns: 1fr auto 1fr; 
            position: relative; 
            height: 60px; 
            flex-shrink: 0; 
            /* Estilos de era eliminados */
        }
        .tab-btn { 
            background: transparent; 
            border: none; 
            padding: 5px; 
            cursor: pointer; 
            font-family: 'VT323'; 
            font-size: 0.9rem; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 4px; 
            height: 100%; 
            /* Estilos de era eliminados */
        }
        .tab-btn.active { 
            /* Estilos de era eliminados */
        }
        
        /* ---- ANIMACIONES GEN√âRICAS (MANTENEMOS ESTAS) ---- */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.9); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes scroll-credits { from { top: 100%; } to { top: -100%; } }
        /* La animaci√≥n 'glow' se define en cada archivo de era, aqu√≠ la dejamos vac√≠a */
        @keyframes glow { 0% { box-shadow: none; } 100% { box-shadow: none; } }
        .can-afford-glow:not(.is-disabled) { /* La animaci√≥n se aplica en el CSS de era */ }
        
        
        /* --- Estilos para Categor√≠as de Mejoras (SOLO ESTRUCTURA) --- */
        .category-header {
            font-family: 'Press Start 2P', cursive;
            padding: 10px 5px;
            margin-top: 20px; 
            margin-bottom: 10px;
            font-size: 1.1rem;
            text-align: left; 
            /* Estilos de era eliminados */
        }
        
        .category-header:first-of-type {
            margin-top: 0; 
        }
        
        /* --- Estilos para Mejoras Bloqueadas por Requisitos (SOLO ESTRUCTURA) --- */
        .upgrade.is-locked {
        	opacity: 0.45;
            transition: opacity 0.3s ease, border-color 0.3s ease; 
            /* Estilos de era eliminados */
        }
        
        .upgrade.is-locked:hover {
            /* Estilos de era eliminados */
        }
        
        /* Opcional pero recomendado: a√±ade un icono de candado al t√≠tulo */
        .upgrade.is-locked .upgrade-info h4::after {
            content: ' üîí'; 
            font-size: 0.8rem;
            vertical-align: middle; 
        }
        
        /* --- Estilos para la Lista de Requisitos Visual (SOLO ESTRUCTURA) --- */
        .requirements-list {
            margin-top: 8px; 
            padding-top: 6px;
            /* Estilos de era eliminados */
            text-align: left;
        }
        
        .requirements-list p {
            font-size: 0.8rem; 
            margin: 2px 0;
            line-height: 1.3;
            /* Estilos de era eliminados */
        }
        
        /* Requisito NO cumplido: color rojo/peligro */
        .requirements-list p.unmet {
            /* Estilos de era eliminados */
        }
        
        /* Requisito S√ç cumplido: color verde/√©xito */
        .requirements-list p.met {
            /* Estilos de era eliminados */
        }
        
        /* Estilos para la informaci√≥n de requisitos (bloqueo activo o futuro) */
        .requirements-list.is-locked-info p.unmet {
            font-weight: bold; 
        }
        
        /* ---- CORRECCI√ìN DE USABILIDAD Y EST√âTICA (Elimina el molesto recuadro de enfoque) ---- */
        
        /* 1. Elimina el 'outline' que aparece al hacer focus/click en desktop/touch */
        button:focus, 
        .buy-button:focus,
        .tab-btn:focus,
        .menu-button:focus {
            outline: none !important;
        }
        
        /* 2. Elimina el molesto 'highlight' azul/gris que aparece al tocar en m√≥viles (iOS/Android) */
        button,
        .main-click-button,
        .tab-btn,
        .shortcut-btn {
            /* Esta propiedad CSS previene que el navegador aplique un fondo de color al ser tocado */
            -webkit-tap-highlight-color: transparent;
            /* Para navegadores viejos o espec√≠ficos, aunque -webkit es el m√°s com√∫n */
            -moz-user-focus: none;
            -moz-user-select: none;
        }
        ---------- FIN CONTENIDO ----------


        ========================================
        üìÅ Carpeta: ./css\eras/
        ========================================

            üìÑ Archivo: era-1g.css
            ---------- CONTENIDO ----------
            /* ==================================================================
               ESTILOS DE ERA: 1G - A√±os 80 (Terminal CRT F√≥sforo Verde)
               ================================================================== */
            
            /* 1. ESTILOS GLOBALES DE LA VENTANA DE JUEGO */
            .game-container { 
                background-color: #020A02; /* Fondo de pantalla de terminal oscuro */
                border: 5px solid #666; /* Borde grueso para simular el bisel del monitor */
                border-radius: 8px; 
                box-shadow: 
                    0 0 20px rgba(0, 255, 0, 0.3), /* Brillo externo */
                    0 0 10px rgba(0, 255, 0, 0.2) inset; /* Brillo interno */
                padding: 0;
            }
            
            /* Aplicamos el color de texto y la sombra de f√≥sforo a todo el contenido del juego */
            .game-container, .tab-panel {
                color: #00FF00; /* Verde F√≥sforo Puro */
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.8), 0 0 8px rgba(0, 255, 0, 0.5);
            }
            
            
            /* 2. BARRA SUPERIOR */
            .top-bar { 
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 12px; /* Reducimos el padding para ser m√°s compactos */
                border-bottom: 2px solid #00AA00; /* Separador de l√≠nea verde */
                background-color: #000; /* Fondo negro puro para el panel */
                flex-shrink: 0; 
                color: #00FF00; /* Color de texto base: F√≥sforo Verde */
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.8); /* Sombra de f√≥sforo */
                font-family: 'VT323', monospace; /* Fuente monoespacio para mejor legibilidad de n√∫meros */
            }
            
            /* Contenedores de Recurso */
            .resource-display {
            	/* Quitamos el Press Start 2P y usamos VT323 para ser m√°s legible en la barra */
            	font-family: 'VT323', monospace; 
            	min-width: 0;
            }
            
            /* Display de Dinero (Capital) */
            #money-display { 
                font-size: 1.2rem; /* Ligeramente m√°s grande para que el n√∫mero destaque */
                color: #00FF00; /* Verde F√≥sforo Puro */
                text-shadow: 0 0 8px #00FF00; /* M√°s brillo para el recurso principal */
                font-weight: bold; /* El texto no tiene font-weight, pero la sombra lo simula */
            }
            
            /* Display de DPS (Flujo de Red) */
            #dps-display { 
                font-size: 0.8rem; 
                margin-top: 2px;
                color: #FFFF00; /* Amarillo para el flujo de red (acci√≥n/alerta sutil) */
                text-shadow: 0 0 5px #FFFF00; 
            }
            
            /* Barra de Atajos (Accesos a Tienda, Logros, etc.) */
            .top-shortcut-bar { 
                display: flex; 
                align-items: center; 
                gap: 10px; /* Reducimos el espacio entre los botones */
            }
            
            
            /* 3. PESTA√ëA PRINCIPAL */
            /* Fondo Animado (CRT Grid) */
            #main-tab-background {
                background-color: #020A02;
                background-image:
                    radial-gradient(circle at center, rgba(0, 255, 0, 0.2) 0%, transparent 60%),
                    linear-gradient(to right, rgba(0, 255, 0, 0.1) 1px, transparent 1px),
                    linear-gradient(to bottom, rgba(0, 255, 0, 0.1) 1px, transparent 1px);
                background-size: 1px 40px, 40px 1px, 40px 40px; 
            }
            /* Efecto de l√≠neas de escaneo */
            #main-tab-background::after {
                background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5) 50%, transparent 50%); 
                background-size: 100% 4px;
                opacity: 0.3;
            }
            .terminal-header {
                background-color: #000;
                color: #00FF00;
                border: 1px solid #00AA00; 
                text-shadow: 0 0 5px #00FF00;
            }
            .terminal-header .status-online {
                color: #FFFF00; /* Amarillo para el estatus online */
                text-shadow: 0 0 5px #FFFF00;
            }
            .prestige-info-top { 
                color: #FF00FF; /* Fucsia para el prestigio */
                text-shadow: 0 0 5px #FF00FF; 
            }
            /* Bot√≥n Principal (El N√∫cleo CRT) */
            .main-click-button { 
                width: 200px; 
                height: 200px;
                background: radial-gradient(circle, #00FF00, #008800); 
                border: 5px solid #00FF00; 
                box-shadow: 0 0 30px #00FF00, inset 0 0 15px rgba(255, 255, 255, 0.5); 
            }
            .main-click-button:active { box-shadow: 0 0 5px #00FF00; }
            .main-click-button small { color: #FFFF00; }
            
            
            /* 4. PESTA√ëA MEJORAS */
            
            /* Encabezados de Categor√≠a */
            .category-header {
                color: #FF00FF; /* Fucsia */
                text-shadow: 0 0 5px #FF00FF;
                border-bottom: 2px solid #00AA00; /* L√≠nea separadora verde */
            }
            /* Contenedor de Mejora (Tarjeta de Circuito) */
            .upgrade {
                padding: 5px 8px; 
                grid-template-columns: auto 1fr 105px; 
                align-items: center;
                gap: 8px; /* Espacio reducido */
                
                background-color: rgba(0, 100, 0, 0.1); 
                border: 1px solid #00AA00; 
                border-radius: 0;
                box-shadow: 0 0 5px rgba(0, 255, 0, 0.1); 
            }
            .upgrade:hover {
                background-color: rgba(0, 100, 0, 0.3);
            }
            
            /* Icono */
            .upgrade-icon {
                font-size: 1.4rem; /* Reducci√≥n ligera del tama√±o de icono */
            }
            
            /* Secci√≥n de Informaci√≥n */
            .upgrade-info h4 {
                margin: 0 0 1px 0; /* Espacio muy reducido despu√©s del t√≠tulo */
                font-size: 1.05rem; /* Fuente del t√≠tulo un poco m√°s compacta */
                line-height: 1.1;
            }
            .upgrade-info p {
                color: #99FF99; 
                font-size: 0.8rem; /* Fuente de la descripci√≥n m√°s peque√±a */
                line-height: 1.2;
            }
            
            /* Bot√≥n de Compra */
            .buy-button {
                padding: 8px 5px; /* Padding muy reducido */
                font-size: 0.65rem; /* Fuente m√°s peque√±a */
                
                color: #FFFF00; 
                border: 2px solid #FFFF00;
                border-radius: 0;
                font-family: 'Press Start 2P', cursive;
                text-shadow: 0 0 5px #FFFF00; 
            }
            .buy-button:not(.is-disabled):hover {
                background-color: #FFFF00;
                color: #000;
                box-shadow: 0 0 15px #FFFF00;
            }
            .buy-button.is-disabled {
                border-color: #666; 
                color: #666;
                text-shadow: none;
            }
            
            /* Mejoras Bloqueadas (Mantenemos los estilos de era) */
            .upgrade.is-locked {
                border-color: #003300; 
                background-color: rgba(0, 0, 0, 0.5); 
            }
            /* Requisitos Visuales */
            .requirements-list {
                margin-top: 5px; /* Espacio reducido */
                padding-top: 4px; /* Padding reducido */
                border-top: 1px dashed rgba(0, 255, 0, 0.3);
            }
            .requirements-list p.unmet {
                color: #FF0000; 
                text-shadow: 0 0 3px #FF0000;
            }
            .requirements-list p.met {
                color: #00FF00; 
                text-shadow: 0 0 3px #00FF00;
            }
            
            
            /* 5. PESTA√ëA EVOLUCI√ìN */
            .evolution-content h2 { 
                color: #FF00FF; 
                text-shadow: 0 0 5px #FF00FF; 
            }
            .current-era { 
                background: rgba(0,0,0,0.5); 
                border: 1px solid #FF00FF; 
                color: #00FF00;
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.8);
            }
            /* Bot√≥n Relanzar (Prestigio) */
            .relaunch-button-styled { 
                color: #FF00FF; 
                border: 3px solid #FF00FF; 
                border-radius: 0; 
                text-shadow: 0 0 10px #FF00FF;
            }
            .relaunch-button-styled:not(.is-disabled):hover { 
                background-color: #FF00FF; 
                color: #000; 
                box-shadow: 0 0 20px #FF00FF; 
            }
            .relaunch-button-styled.is-disabled { 
                border-color: #444; 
                color: #444; 
                text-shadow: none;
            }
            
            
            /* 6. BARRA DE NAVEGACI√ìN INFERIOR */
            .game-tab-bar { 
                border-top: 3px solid #00FF00; 
                height: 70px;
                background-color: #1A1A1A; /* Panel oscuro */
            }
            .tab-btn { 
                background: #252525; /* Fondo de tecla */
                border-right: 1px solid #00AA00; 
                color: #00FF00; 
                font-family: 'Press Start 2P', cursive; 
                font-size: 0.8rem; 
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.5);
            }
            .tab-btn:hover:not(.active) {
                background: #303030;
                color: #FFFF00;
                text-shadow: 0 0 5px #FFFF00;
            }
            .tab-btn.active { 
                background: #00FF00; 
                color: #000; 
                text-shadow: none;
            }
            .tab-btn:first-child { border-left: none; }
            .tab-btn:last-child { border-right: none; }
            
            
            /* 7. ANIMACIONES DE RESPLANDOR (ESPEC√çFICAS DE LA ERA) */
            @keyframes glow {
                0% {
                    box-shadow: 0 0 5px #FFFF00, 0 0 10px #FFFF00 inset;
                }
                50% {
                    box-shadow: 0 0 15px #FFFF00, 0 0 20px #FFFF00 inset;
                }
                100% {
                    box-shadow: 0 0 5px #FFFF00, 0 0 10px #FFFF00 inset;
                }
            }
            .can-afford-glow:not(.is-disabled) { animation: glow 2s infinite; }
            
            /* Animaci√≥n espec√≠fica para el bot√≥n de prestigio (Fucsia) */
            @keyframes glow-prestige {
                0% {
                    box-shadow: 0 0 5px #FF00FF, 0 0 10px #FF00FF inset;
                }
                50% {
                    box-shadow: 0 0 15px #FF00FF, 0 0 20px #FF00FF inset;
                }
                100% {
                    box-shadow: 0 0 5px #FF00FF, 0 0 10px #FF00FF inset;
                }
            }
            .relaunch-button-styled.can-afford-glow { animation: glow-prestige 2s infinite; }
            
            /* 8. ESTILOS DE ATAJO (SHORTCUTS) - MOVIDOS DE icons.css */
            
            .top-shortcut-bar .shortcut-btn i {
                width: 30px; /* Tama√±o m√°s peque√±o y compacto */
                height: 30px;
                background: #1A1A1A; /* Fondo de panel oscuro */
                border: 1px solid #00AA00; /* Borde de verde intermedio */
                border-radius: 2px; /* Ligeramente cuadrado para la terminal */
                color: #FFFF00; /* Color de icono: Amarillo F√≥sforo para acci√≥n */
                text-shadow: 0 0 5px #FFFF00;
                transition: all 0.2s ease;
            }
            
            .top-shortcut-bar .shortcut-btn:hover i {
                background-color: #00FF00; /* Fondo activo en verde puro */
                color: #000; /* Texto oscuro en fondo brillante */
                box-shadow: 0 0 10px #00FF00;
                text-shadow: none;
            }
            ---------- FIN CONTENIDO ----------

            üìÑ Archivo: era-2g.css
            ---------- CONTENIDO ----------

            ---------- FIN CONTENIDO ----------

            üìÑ Archivo: era-3g.css
            ---------- CONTENIDO ----------

            ---------- FIN CONTENIDO ----------

            üìÑ Archivo: era-4g.css
            ---------- CONTENIDO ----------

            ---------- FIN CONTENIDO ----------

            üìÑ Archivo: era-5g.css
            ---------- CONTENIDO ----------

            ---------- FIN CONTENIDO ----------


    ========================================
    üìÅ Carpeta: ./js/
    ========================================

        üìÑ Archivo: audio.js
        ---------- CONTENIDO ----------
        // --- NUEVO: Bandera para controlar la reproducci√≥n de clips ---
        // Evita que se dispare un nuevo clip si otro ya est√° sonando.
        let isClipPlaying = false;
        
        // --- NUEVO: Volumen base para la m√∫sica durante el juego ---
        // Lo definimos aqu√≠ para que sea f√°cil de ajustar y reutilizar.
        const GAME_MUSIC_VOLUME = 0.2;
        const TITLE_MUSIC_VOLUME = 0.4;
        
        // Definimos todos nuestros sonidos usando Howler.js
        const sounds = {
            // La m√∫sica de fondo no cambia
            titleMusic: new Howl({
                src: ['assets/audio/title-music.mp3'],
                volume: TITLE_MUSIC_VOLUME,
                loop: true,
                preload: true,
                html5: true
            }),
            
            // --- NUEVO: Array para tus clips de audio aleatorios ---
            randomClips: [
                new Howl({
                    src: ['assets/audio/clips/Rikisisisimo.wav'],
                    volume: 0.7
                }),
                new Howl({
                    src: ['assets/audio/clips/Corazon_de_zeda.wav'],
                    volume: 0.7
                }),
                new Howl({
                    src: ['assets/audio/clips/bebesita.mp3'],
                    volume: 0.7
                }),
        		new Howl({
                    src: ['assets/audio/clips/shakira.mp3'],
                    volume: 0.7
                })
            ],
        
            // Los sonidos de la UI no cambian
            click: new Howl({
                src: ['assets/audio/click.mp3'],
                volume: 0.7,
                pool: 5
            }),
            buySuccess: new Howl({
                src: ['assets/audio/success.mp3'],
                volume: 0.2
            }),
            buyFail: new Howl({
                src: ['assets/audio/fail.mp3'],
                volume: 0.6
            })
        };
        
        // Funci√≥n global para reproducir un sonido por su nombre (sin cambios).
        function playSound(soundName) {
            if (sounds[soundName]) {
                sounds[soundName].play();
            }
        }
        
        // --- NUEVA FUNCI√ìN PRINCIPAL ---
        // Esta es la funci√≥n que orquesta todo el efecto de "audio ducking".
        function playRandomSoundClip() {
            // 1. Si ya hay un clip sonando o si no hay clips definidos, no hacemos nada.
            if (isClipPlaying || sounds.randomClips.length === 0) {
                return;
            }
            
            // 2. Activamos la bandera para bloquear otros clips.
            isClipPlaying = true;
        
            // 3. Elegimos un clip de audio al azar del array.
            const clip = sounds.randomClips[Math.floor(Math.random() * sounds.randomClips.length)];
        
            // 4. Bajamos suavemente el volumen de la m√∫sica de fondo.
            //    El m√©todo .fade() va de un volumen a otro en un tiempo determinado (en milisegundos).
            sounds.titleMusic.fade(GAME_MUSIC_VOLUME, 0.05, 800); // Baja a 5% de volumen en 0.8s
        
            // 5. Escuchamos el evento 'end' del clip. Esto es clave.
            //    .once() se asegura de que esta funci√≥n solo se ejecute una vez, cuando el clip termine.
            clip.once('end', () => {
                // Cuando el clip ha terminado, subimos el volumen de la m√∫sica de vuelta a su nivel original.
                sounds.titleMusic.fade(0.05, GAME_MUSIC_VOLUME, 1200); // Sube de vuelta al volumen de juego en 1.2s
                
                // Liberamos la bandera para que otro clip pueda sonar en el futuro.
                isClipPlaying = false;
            });
        
            // 6. ¬°Reproducimos el clip elegido!
            clip.play();
        }
        
        // NUEVA FUNCI√ìN para controlar el volumen de todos los sonidos
        function setMasterVolume(level) {
            Howler.volume(level);
        }
        ---------- FIN CONTENIDO ----------

        üìÑ Archivo: main.js
        ---------- CONTENIDO ----------
        // ---- DEFINICIONES Y ESTADO DEL JUEGO (ESTRUCTURA BALANCEADA Y SINE√âRGICA) ----
        const upgrades = {
            'infraestructura': {
                name: 'Infraestructura y Expansi√≥n',
                items: {
                    'lineaCobre': {
                        name: 'Instalar L√≠nea de Cobre',
                        description: 'El primer paso. Conecta clientes y genera ingresos pasivos.',
                        type: 'dps',
                        baseCost: 20,
                        baseEffect: 0.5,
                        requirements: [
                            // CORREGIDO: Ahora requiere marketing para crecer, pero el marketing no lo requiere a √©l en un bucle.
                            { level: 10, reqs: { 'kitHerramientas': 5, 'marketingLocal': 1 } },
                            { level: 30, reqs: { 'tecladoTonos': 15 } },
                            { level: 75, reqs: { 'centralitaAnaloga': 10, 'softwareTerminal': 40 } }
                        ]
                    },
                    'antenaRepetidora': {
                        name: 'Instalar Antena Repetidora',
                        description: 'Amplifica la se√±al para llegar a las afueras de la ciudad.',
                        type: 'dps',
                        baseCost: 180,
                        baseEffect: 5,
                        requirements: [
                            { level: 1, reqs: { 'lineaCobre': 25 } },
                            { level: 15, reqs: { 'softwareTerminal': 10 } },
                            { level: 35, reqs: { 'centralitaAnaloga': 5 } }
                        ]
                    },
                    'centralitaAnaloga': {
                        name: 'Construir Centralita Anal√≥gica',
                        description: 'Un conmutador que gestiona docenas de l√≠neas autom√°ticamente.',
                        type: 'dps',
                        baseCost: 1800,
                        baseEffect: 30,
                        requirements: [
                            { level: 1, reqs: { 'lineaCobre': 50, 'softwareTerminal': 20 } },
                            { level: 15, reqs: { 'servidorBBS': 5 } },
                            { level: 40, reqs: { 'antenaRepetidora': 25, 'modem2400': 15 } }
                        ]
                    },
                    'centralitaDigital': {
                        name: 'Actualizar a Centralita Digital',
                        description: 'Reemplaza rel√©s por microchips para una eficiencia sin precedentes.',
                        type: 'dps',
                        baseCost: 50000,
                        baseEffect: 220,
                        requirements: [
                            { level: 1, reqs: { 'centralitaAnaloga': 35, 'servidorBBS': 15 } },
                            { level: 25, reqs: { 'modem2400': 50 } }
                        ]
                    },
                    'fibraOptica': {
                        name: 'Red de Fibra √ìptica',
                        description: 'Tecnolog√≠a experimental que usa pulsos de luz. Un salto cu√°ntico.',
                        type: 'dps',
                        baseCost: 250000,
                        baseEffect: 500,
                        requirements: [
                            { level: 1, reqs: { 'centralitaDigital': 15, 'protocoloTCPIP': 20 } },
                            { level: 20, reqs: { 'tarjetaRed': 100 } }
                        ]
                    }
                }
            },
            'equipamiento': {
                name: 'Equipamiento y Terminales',
                items: {
                    'kitHerramientas': {
                        name: 'Kit de Herramientas B√°sico',
                        description: 'Un buen soldador y alicates. Cada conexi√≥n manual es m√°s limpia.',
                        type: 'dpc',
                        baseCost: 15,
                        baseEffect: 1,
                        requirements: []
                    },
                    'tecladoTonos': {
                        name: 'Teclado de Tonos DTMF',
                        description: 'Reemplaza el dial rotatorio, optimizando cada clic.',
                        type: 'dpc',
                        baseCost: 100,
                        baseEffect: 3,
                        requirements: [
                            { level: 5, reqs: { 'kitHerramientas': 10, 'lineaCobre': 5 } },
                            { level: 25, reqs: { 'centralitaAnaloga': 1, 'softwareTerminal': 10 } }
                        ]
                    },
                    'modem2400': {
                        name: 'M√≥dem 2400 baudios',
                        description: 'Permite a los ordenadores comunicarse por v√≠a telef√≥nica.',
                        type: 'dps',
                        baseCost: 800,
                        baseEffect: 12,
                        requirements: [
                            { level: 1, reqs: { 'antenaRepetidora': 10 } },
                            { level: 20, reqs: { 'softwareTerminal': 25 } },
                            { level: 40, reqs: { 'centralitaAnaloga': 10 } }
                        ]
                    },
                    'tarjetaRed': {
                        name: 'Tarjeta de Red ISA',
                        description: 'Una placa para PCs que permite conexiones directas y eficientes.',
                        type: 'dpc',
                        baseCost: 15000,
                        baseEffect: 25,
                        requirements: [
                            { level: 1, reqs: { 'protocoloTCPIP': 1, 'softwareTerminal': 50 } },
                            { level: 15, reqs: { 'centralitaDigital': 5 } }
                        ]
                    }
                }
            },
            'software': {
                name: 'Software y Protocolos',
                items: {
                    'marketingLocal': {
                        name: 'Campa√±a de Marketing Local',
                        description: 'Anuncios en peri√≥dicos. Atrae demanda para tu red de cobre.',
                        type: 'dps',
                        baseCost: 300,
                        baseEffect: 3,
                        requirements: [
                            // CORREGIDO: Ahora solo requiere una PEQUE√ëA base de cobre para empezar. Esto rompe el deadlock.
                            { level: 1, reqs: { 'lineaCobre': 5 } },
                            { level: 15, reqs: { 'tecladoTonos': 10 } }
                        ]
                    },
                    'softwareTerminal': {
                        name: 'Software de Terminal',
                        description: 'Un c√≥digo m√°s limpio para procesar datos m√°s r√°pido en cada clic.',
                        type: 'dpc',
                        baseCost: 180,
                        baseEffect: 5,
                        requirements: [
                            { level: 1, reqs: { 'tecladoTonos': 5 } },
                            { level: 20, reqs: { 'lineaCobre': 30 } },
                            { level: 40, reqs: { 'modem2400': 10, 'centralitaAnaloga': 5 } }
                        ]
                    },
                    'servidorBBS': {
                        name: 'Servidor BBS "El Eco Digital"',
                        description: 'Crea una comunidad online. Los usuarios pagan una cuota por acceso.',
                        type: 'dps',
                        baseCost: 9000,
                        baseEffect: 80,
                        requirements: [
                            { level: 1, reqs: { 'centralitaAnaloga': 5 } },
                            { level: 10, reqs: { 'softwareTerminal': 30 } },
                            // L√ìGICA CORREGIDA: Para escalar, un BBS necesita una base masiva de usuarios con m√≥dems, no una tecnolog√≠a futura.
                            { level: 25, reqs: { 'modem2400': 30 } }
                        ]
                    },
                    'protocoloTCPIP': {
                        name: 'Implementar Protocolo TCP/IP',
                        description: 'Estandariza tu red para un tr√°fico masivo. La base de Internet.',
                        type: 'dpc',
                        baseCost: 65000,
                        baseEffect: 60,
                        requirements: [
                            { level: 1, reqs: { 'centralitaDigital': 1, 'servidorBBS': 10 } },
                            { level: 10, reqs: { 'centralitaAnaloga': 50 } }
                        ]
                    }
                }
            }
        };
        
        const GAME_VERSION = "1.1"; // Puedes usar el n√∫mero que quieras. S√∫belo cada vez que cambies la estructura de guardado.
        const SAVE_KEY = 'imperioConexionSave_v2'; // Cambiamos el nombre para invalidar guardados muy antiguos y evitar errores complejos.
        
        // AHORA, REEMPLAZA EL OBJETO "gameState" CON ESTE, NOTA LA NUEVA LISTA EN "upgradeLevels"
        let gameState = {
        	version: GAME_VERSION,
            money: 0,
            moneyPerClick: 1,
            moneyPerSecond: 0,
            totalMoneyEver: 0,
            prestigePoints: 0,
            upgradeLevels: {
                // Infraestructura
                'lineaCobre': 0,
                'antenaRepetidora': 0,
                'centralitaAnaloga': 0,
                'centralitaDigital': 0,
                'fibraOptica': 0,
                // Equipamiento
                'kitHerramientas': 0,
                'tecladoTonos': 0,
                'modem2400': 0,
                'tarjetaRed': 0,
                // Software
                'marketingLocal': 0,
                'softwareTerminal': 0,
                'servidorBBS': 0,
                'protocoloTCPIP': 0
            },
        };
        
        // ---- L√ìGICA DE GUARDADO, C√ÅLCULO Y PRINCIPAL (SIN CAMBIOS) ----
        let isResetting = false; 
        function saveGame() { 
        	if (isResetting) 
        		return; 
        	try { 
        		localStorage.setItem(SAVE_KEY, JSON.stringify(gameState)); 
        	} catch(e) {} 
        } 
        function loadGame() {
            try {
                const savedJSON = localStorage.getItem(SAVE_KEY);
                if (!savedJSON) {
                    // No hay partida guardada, se usa el gameState por defecto.
                    return;
                }
        
                const savedState = JSON.parse(savedJSON);
        
                // Si la versi√≥n es la misma, simplemente cargamos el estado y listo.
                if (savedState.version === GAME_VERSION) {
                    gameState = savedState;
                    return;
                }
        
                // --- INICIO DE LA MIGRACI√ìN ---
                // La versi√≥n del guardado es diferente (o no existe), as√≠ que migramos los datos.
                console.warn(`Migrando partida guardada desde la versi√≥n ${savedState.version || 'antigua'} a ${GAME_VERSION}`);
        
                // 1. Empezamos con la estructura por defecto de la nueva versi√≥n del juego.
                const migratedState = JSON.parse(JSON.stringify(gameState)); // Copia profunda del estado por defecto.
        
                // 2. Transferimos las propiedades simples (dinero, prestigio, etc.).
                migratedState.money = savedState.money || 0;
                migratedState.totalMoneyEver = savedState.totalMoneyEver || 0;
                migratedState.prestigePoints = savedState.prestigePoints || 0;
        
                // 3. Fusionamos los niveles de las mejoras de forma segura.
                //    Iteramos sobre las mejoras de la NUEVA versi√≥n del juego.
                for (const upgradeId in migratedState.upgradeLevels) {
                    // Si la mejora exist√≠a en la partida GUARDADA, transferimos su nivel.
                    if (savedState.upgradeLevels && savedState.upgradeLevels.hasOwnProperty(upgradeId)) {
                        migratedState.upgradeLevels[upgradeId] = savedState.upgradeLevels[upgradeId];
                    }
                    // Si no exist√≠a (porque es una mejora nueva), se quedar√° en 0 (su valor por defecto).
                }
                
                // 4. Actualizamos la versi√≥n en el objeto de estado y lo asignamos al juego.
                migratedState.version = GAME_VERSION;
                gameState = migratedState;
        
                // 5. Guardamos inmediatamente el estado migrado para la pr√≥xima vez.
                saveGame();
                console.log("Migraci√≥n completada con √©xito.");
        
            } catch (e) {
                console.error("Error al cargar o migrar la partida guardada:", e);
                // Opcional: en caso de error cr√≠tico, se puede resetear el guardado.
                // resetSave(); 
            }
        }
        function resetSave() { 
        	if (confirm("¬øBorrar progreso?")) { 
        		isResetting = true; 
        		localStorage.removeItem(SAVE_KEY); 
        		window.location.reload(); 
        	} 
        }
        
        function findUpgradeById(upgradeId) {
            for (const categoryId in upgrades) {
                if (upgrades[categoryId].items[upgradeId]) {
                    return upgrades[categoryId].items[upgradeId];
                }
            }
            return null; // No se encontr√≥ la mejora
        }
        
        function findNextRequirementHurdle(upgradeId) {
            const upgrade = findUpgradeById(upgradeId);
            if (!upgrade || !upgrade.requirements || upgrade.requirements.length === 0) {
                return null; // Si una mejora no tiene requisitos, nunca se bloquea.
            }
        
            const currentUpgradeLevel = gameState.upgradeLevels[upgradeId] || 0;
            
            // [NUEVA L√çNEA CLAVE] Calculamos el nivel al que el jugador quiere llegar con su pr√≥xima compra.
            const nextLevelToBuy = currentUpgradeLevel + 1;
            
            // Iteramos sobre los requisitos para encontrar el PRIMER hito que NO hemos cumplido a√∫n
            for (const hurdle of upgrade.requirements) {
                // Si el nivel actual de la mejora es MENOR que el nivel requerido para este hito,
                // entonces este hito es un POTENCIAL BLOQUEO.
                if (currentUpgradeLevel < hurdle.level) {
                    let allDependenciesMet = true;
                    for (const reqId in hurdle.reqs) {
                        const requiredLevel = hurdle.reqs[reqId];
                        const currentReqLevel = gameState.upgradeLevels[reqId] || 0;
                        
                        if (currentReqLevel < requiredLevel) {
                            allDependenciesMet = false;
                            break; // Una dependencia no se cumple, este hito est√° bloqueando.
                        }
                    }
        
                    if (!allDependenciesMet) {
                        // Hemos encontrado el PRIMER hito futuro con dependencias NO cumplidas.
                        
                        // --- INICIO DE LA CORRECCI√ìN DE L√ìGICA ---
                        // Solo bloqueamos si el pr√≥ximo nivel a comprar (nextLevelToBuy) alcanza el nivel del hito.
                        if (nextLevelToBuy < hurdle.level) {
                            // El bloqueo es lejano (ej. estamos en L1 y el bloqueo es en L25).
                            // Esto significa que las compras no est√°n bloqueadas AHORA,
                            // ya que los hitos anteriores (L10) debieron cumplirse para llegar hasta aqu√≠.
                            // Por lo tanto, devolvemos null para que la compra sea permitida.
                            return null; 
                        }
                        // --- FIN DE LA CORRECCI√ìN DE L√ìGICA ---
                        
                        // Si este hito es el primero que a√∫n no hemos alcanzado (porque currentUpgradeLevel < hurdle.level)
                        // Y sus dependencias NO est√°n cumplidas, y la pr√≥xima compra lo alcanza, este es el hito que nos bloquea.
                        return hurdle;
                    }
                    // Si las dependencias S√ç est√°n cumplidas, seguimos buscando el siguiente hito,
                    // ya que este no nos bloquea m√°s all√° del nivel de la mejora.
                }
            }
        
            // Si hemos revisado todos los requisitos y no encontramos ning√∫n hito bloqueante,
            // significa que todos los requisitos previos han sido superados o sus dependencias est√°n OK.
            return null;
        }
        
        function areRequirementsMet(upgradeId) {
            return findNextRequirementHurdle(upgradeId) === null;
        }
        
        function calculateUpgradeCost(upgradeId) {
            const upgrade = findUpgradeById(upgradeId);
            const level = gameState.upgradeLevels[upgradeId] || 0;
            return Math.floor(upgrade.baseCost * Math.pow(1.12, level));
        }
        
        function calculatePrestigePointsToGain() {
            const f = 100000;
            const p = Math.floor(Math.pow(gameState.totalMoneyEver / f, 0.4));
            return p > 0 ? p : 0;
        }
        
        function recalculateGains() {
            let baseDpc = 1;
            let baseDps = 0;
            let dpcMultiplier = 1;
            let dpsMultiplier = 1;
        
            // Bucle anidado para recorrer la nueva estructura
            for (const categoryId in upgrades) {
                for (const id in upgrades[categoryId].items) {
                    const u = upgrades[categoryId].items[id];
                    const l = gameState.upgradeLevels[id] || 0;
                    
                    if (l > 0) {
                        switch (u.type) {
                            case 'dpc':
                                baseDpc += u.baseEffect * l;
                                break;
                            case 'dps':
                                baseDps += u.baseEffect * l;
                                break;
                            case 'dpc_multiplier':
                                dpcMultiplier += u.baseEffect * l;
                                break;
                            case 'dps_multiplier':
                                dpsMultiplier += u.baseEffect * l;
                                break;
                        }
                    }
                }
            }
        
            const prestigeMultiplier = 1 + (gameState.prestigePoints * 0.02);
            
            gameState.moneyPerClick = (baseDpc * dpcMultiplier) * prestigeMultiplier;
            gameState.moneyPerSecond = (baseDps * dpsMultiplier) * prestigeMultiplier;
        }
        
        function buyUpgrade(upgradeId) {
            // Primero, verificamos que la mejora no est√© bloqueada por un hito de requisitos.
            if (!areRequirementsMet(upgradeId)) {
                playSound('buyFail'); // El jugador est√° chocando contra un muro de requisitos.
                return;
            }
            
            const cost = calculateUpgradeCost(upgradeId);
            
            // Si no est√° bloqueada, entonces verificamos si tiene el dinero.
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.upgradeLevels[upgradeId]++;
                recalculateGains();
                updateUI(); // Actualizamos la UI inmediatamente para que el cambio sea visible.
                playSound('buySuccess');
            } else {
                playSound('buyFail'); // No tiene suficiente dinero.
            }
        }
        function addMoney(amount) { 
        	if(typeof amount === 'number' && !isNaN(amount)) { 
        		gameState.money += amount; 
        		gameState.totalMoneyEver += amount; 
        	} 
        } 
        function generateMoneyOnClick() { 
        	addMoney(gameState.moneyPerClick); 
        } 
        function prestigeReset() {
            const points = calculatePrestigePointsToGain();
            if (points > 0) {
                if (confirm(`¬øRelanzar para ganar ${points} Puntos?`)) {
                    gameState.prestigePoints += points;
                    gameState.money = 0;
                    gameState.totalMoneyEver = 0;
                    
                    // --- CAMBIO AQU√ç ---
                    // En lugar de una lista manual, resetea todos los niveles a 0.
                    for (const key in gameState.upgradeLevels) {
                        gameState.upgradeLevels[key] = 0;
                    }
                    // --- FIN DEL CAMBIO ---
        
                    recalculateGains();
                    saveGame();
                    updateUI(); // Actualiza la UI para reflejar el reseteo
                }
            }
        }
        
        // ---- BUCLE DEL JUEGO ----
        let gameLoopInterval = null; 
        function gameLoop() { 
        	addMoney(gameState.moneyPerSecond / 10); 
        	updateUI(); 
        	
        	randomClipTimer += 100; // El bucle se ejecuta cada 100ms
            if (randomClipTimer >= nextClipTime) {
                playRandomSoundClip(); // ¬°Llamamos a nuestra nueva funci√≥n de audio.js!
                randomClipTimer = 0; // Reseteamos el contador
                nextClipTime = calculateNextClipTime(); // Calculamos el pr√≥ximo intervalo aleatorio
            }
        }
        
        // --- NUEVAS VARIABLES PARA EL TEMPORIZADOR DE CLIPS ---
        let randomClipTimer = 0; // Acumula el tiempo transcurrido.
        let nextClipTime = calculateNextClipTime(); // Almacena el tiempo aleatorio para el siguiente clip.
        
        // Funci√≥n para calcular un intervalo aleatorio (ej. entre 15 y 35 segundos)
        function calculateNextClipTime() {
            return 15000 + (Math.random() * 20000); // 15s de base + hasta 20s aleatorios
        }
        
        // ---- GESTOR DE PANTALLAS Y PESTA√ëAS ----
        const allScreens = document.querySelectorAll('.full-screen, .game-container');
        const allTabPanels = document.querySelectorAll('.tab-panel');
        function showScreen(screenId) { allScreens.forEach(s => s.classList.add('hidden')); document.getElementById(screenId).classList.remove('hidden'); }
        function showTab(tabId) {
            allTabPanels.forEach(p => p.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.toggle('active', b.dataset.tab === tabId);
            });
        }
        function returnToMainMenu() {
            // 1. Detener el bucle del juego (DPS)
            if (gameLoopInterval) {
                clearInterval(gameLoopInterval);
                gameLoopInterval = null;
            }
            
            // 2. Guardar el progreso
            saveGame();
            
            // 3. Mostrar la pantalla principal del men√∫
            showScreen('main-menu-screen');
            
            // 4. Reiniciar la m√∫sica (subir volumen si se baj√≥ antes)
            sounds.titleMusic.fade(GAME_MUSIC_VOLUME, TITLE_MUSIC_VOLUME, 1000);
            
            // Opcional: Pausar la m√∫sica si quieres que se reanude en el men√∫, 
            // pero si est√° en bucle, solo nos aseguramos del volumen.
        }
        
        // ---- L√ìGICA DE INICIALIZACI√ìN ----
        let inGameListenersInitialized = false; // Bandera para asegurar que solo se ejecuta una vez
        
        function initializeInGameEventListeners() {
            if (inGameListenersInitialized) return; // Si ya est√° inicializado, no hace nada
        
            // Listener para la BARRA DE PESTA√ëAS INFERIOR
            document.getElementById('game-tab-bar').addEventListener('click', (event) => {
                const navButton = event.target.closest('.tab-btn');
                if (navButton) showTab(navButton.dataset.tab);
            });
        
            // Listener para la BARRA DE ATAJOS SUPERIOR
            const gameContainer = document.getElementById('game-container'); // Referencia al contenedor principal
        
        	// Listener para la BARRA DE ATAJOS SUPERIOR
        	document.getElementById('top-shortcut-bar').addEventListener('click', (event) => {
        		const shortcutButton = event.target.closest('.shortcut-btn');
        		if (shortcutButton) {
        			// A√±adimos la clase al contenedor principal para mostrar el pop-up y el fondo
        			gameContainer.classList.add('popup-visible');
        		}
        	});
        
        	// Listener para el BOT√ìN DE CERRAR
        	document.getElementById('close-popup-button').addEventListener('click', (event) => {
        		event.stopPropagation();
        		gameContainer.classList.remove('popup-visible');
        	});
        
            // Listeners para los botones de acci√≥n del juego
            document.getElementById('main-click-button').addEventListener('click', (event) => {
                generateMoneyOnClick();
                showFloatingNumber(event);
                playSound('click');
            });
        
            document.getElementById('upgrades-container').addEventListener('click', (event) => {
                const button = event.target.closest('.buy-button');
                if (!button) return;
                if (button.classList.contains('is-disabled')) { playSound('buyFail'); return; }
                buyUpgrade(button.dataset.upgradeId);
            });
            
            document.getElementById('relaunch-button').addEventListener('click', (event) => {
                const button = event.target.closest('button');
                if (button.classList.contains('is-disabled')) { playSound('buyFail'); } else { prestigeReset(); }
            });
        	
        	document.getElementById('top-shortcut-bar').addEventListener('click', (event) => {
                const shortcutButton = event.target.closest('.shortcut-btn');
                const shortcutId = shortcutButton ? shortcutButton.id : null;
        
                if (shortcutId === 'menu-button-shortcut') {
                    returnToMainMenu(); // Llama a la nueva funci√≥n
                    return; // Sale de la funci√≥n para no activar el pop-up de "Pr√≥ximamente"
                }
                
                if (shortcutButton) {
                    // A√±adimos la clase al contenedor principal para mostrar el pop-up y el fondo
                    gameContainer.classList.add('popup-visible');
                }
            });
        
            inGameListenersInitialized = true; // Marca como inicializado
        }
        
        function startGame() {
            // 1. Muestra la pantalla del juego. AHORA los botones son visibles en el DOM.
            showScreen('game-container');
            showTab('main-tab');
            
            // 2. INICIALIZA LOS LISTENERS DEL JUEGO. Ahora s√≠ encontrar√° los botones.
            initializeInGameEventListeners();
        
            // 3. Carga datos y arranca el bucle.
            loadGame();
            recalculateGains();
            renderUpgrades();
            if(gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 100);
        }
        
        // ---- SECUENCIA DE ARRANQUE GENERAL ----
        window.addEventListener('load', () => {
            // ---- Listeners para Men√∫s y Navegaci√≥n General (Fuera del juego) ----
            const loadingScreen = document.getElementById('loading-screen');
            const tapToStartScreen = document.getElementById('tap-to-start-screen');
            const volumeSlider = document.getElementById('master-volume');
            showScreen('loading-screen');
            setTimeout(() => { showScreen('tap-to-start-screen'); }, 2500);
            tapToStartScreen.addEventListener('click', () => { showScreen('main-menu-screen'); sounds.titleMusic.play(); sounds.titleMusic.fade(0, 0.4, 2000); }, { once: true });
            document.getElementById('play-button').addEventListener('click', () => { sounds.titleMusic.fade(TITLE_MUSIC_VOLUME, GAME_MUSIC_VOLUME, 1000); startGame(); });
            document.getElementById('story-button').addEventListener('click', () => showScreen('story-screen'));
            document.getElementById('options-button-menu').addEventListener('click', () => showScreen('options-screen'));
            document.getElementById('credits-button').addEventListener('click', () => showScreen('credits-screen'));
            document.querySelectorAll('.back-button').forEach(button => button.addEventListener('click', () => showScreen('main-menu-screen')));
            document.getElementById('reset-save-button').addEventListener('click', resetSave);
            volumeSlider.addEventListener('input', (event) => { setMasterVolume(event.target.value); localStorage.setItem('masterVolume', event.target.value); });
            const savedVolume = localStorage.getItem('masterVolume');
            if (savedVolume !== null) { volumeSlider.value = savedVolume; setMasterVolume(savedVolume); } else { volumeSlider.value = 1; }
            
            // Listener para el guardado al cerrar la p√°gina
            window.addEventListener('beforeunload', saveGame);
        });
        ---------- FIN CONTENIDO ----------

        üìÑ Archivo: ui.js
        ---------- CONTENIDO ----------
        // ---- ELEMENTOS DE LA INTERFAZ (UI ELEMENTS) ----
        const moneyDisplay = document.getElementById('money-display');
        const dpsDisplay = document.getElementById('dps-display');
        const dpcDisplay = document.getElementById('dpc-display');
        const upgradesContainer = document.getElementById('upgrades-container');
        const interactionArea = document.querySelector('.interaction-area');
        const prestigePointsDisplay = document.getElementById('prestige-points-display');
        const relaunchButton = document.getElementById('relaunch-button'); // CONSTANTE NUEVA
        
        // ... (La funci√≥n formatNumber y showFloatingNumber no cambian) ...
        function formatNumber(number) { if (Math.abs(number) < 1000) return number.toFixed(0); const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc"]; const tier = Math.floor(Math.log10(Math.abs(number)) / 3); if (tier >= suffixes.length) return number.toExponential(2).replace('+', ''); const suffix = suffixes[tier]; const scale = Math.pow(10, tier * 3); const scaled = number / scale; return scaled.toFixed(2) + suffix; }
        function showFloatingNumber(event) {
            const container = document.querySelector('.main-click-area');
            if (!container) return; // Si no encuentra el contenedor, no hace nada para evitar errores.
        
            const floatingNumber = document.createElement('span');
            floatingNumber.className = 'floating-number';
            floatingNumber.textContent = `+$${formatNumber(gameState.moneyPerClick)}`;
            floatingNumber.style.left = `${event.pageX - container.getBoundingClientRect().left}px`;
            floatingNumber.style.top = `${event.pageY - container.getBoundingClientRect().top}px`;
            container.appendChild(floatingNumber);
            setTimeout(() => {
                floatingNumber.remove();
            }, 1000);
        }
        
        function renderUpgrades() {
            // Los iconos ahora incluyen las nuevas mejoras que hemos a√±adido.
            const icons = {
                'lineaCobre': 'üîó',
                'antenaRepetidora': 'üì°',
                'centralitaAnaloga': 'üè¢',
                'centralitaDigital': 'ü§ñ',
                'fibraOptica': '‚ú®',
                'kitHerramientas': 'üõ†Ô∏è',
                'tecladoTonos': '‚å®Ô∏è',
                'modem2400': 'üì†',
                'tarjetaRed': 'üîå',
                'softwareTerminal': 'üë®‚Äçüíª',
                'servidorBBS': 'üíæ',
                'protocoloTCPIP': 'üåê',
                'tecnicoJunior': 'üë∑',
                'marketingLocal': 'üì∞',
                'capacitacion': 'üéì'
            };
        
            let html = '';
            // El primer bucle itera sobre las CATEGOR√çAS (ej. 'infraestructura', 'equipamiento').
            for (const categoryId in upgrades) {
                const category = upgrades[categoryId];
                
                // A√±adimos un encabezado H3 para cada categor√≠a.
                html += `<h3 class="category-header">${category.name}</h3>`;
        
                // El segundo bucle (anidado) itera sobre las MEJORAS dentro de esa categor√≠a.
                for (const upgradeId in category.items) {
                    const upgrade = category.items[upgradeId];
                    // Generamos el HTML para cada mejora, igual que antes.
                    // Hemos a√±adido un ID al div contenedor principal para poder seleccionarlo m√°s tarde.
                    html += `
                        <div class="upgrade" id="upgrade-container-${upgradeId}">
                            <div class="upgrade-icon">${icons[upgradeId] || '‚öôÔ∏è'}</div>
                            <div class="upgrade-info">
                                <h4>${upgrade.name} (Nivel <span id="level-${upgradeId}">0</span>)</h4>
                                <p>${upgrade.description}</p>
                            </div>
                            <button id="buy-${upgradeId}" class="buy-button" data-upgrade-id="${upgradeId}">
                                $<span id="cost-${upgradeId}">0</span>
                            </button>
                        </div>`;
                }
            }
            // Finalmente, inyectamos todo el HTML generado en el contenedor.
            upgradesContainer.innerHTML = html;
        }
        
        // ---- FUNCI√ìN PRINCIPAL DE ACTUALIZACI√ìN DE UI ----
        function updateUI() {
            moneyDisplay.textContent = `Capital: $${formatNumber(gameState.money)}`;
            dpsDisplay.textContent = `Flujo de Red: +$${formatNumber(gameState.moneyPerSecond)}/s`;
            dpcDisplay.textContent = `Ancho de Banda: +$${formatNumber(gameState.moneyPerClick)}/conexi√≥n`;
        
            const bonus = gameState.prestigePoints * 2;
            prestigePointsDisplay.textContent = `Puntos de Innovaci√≥n: ${gameState.prestigePoints} (+${bonus}%)`;
            
            // L√ìGICA NUEVA PARA EL BOT√ìN 'relaunch-button'
            const pointsToGain = calculatePrestigePointsToGain();
            if (pointsToGain > 0) {
                relaunchButton.classList.remove('is-disabled');
                relaunchButton.textContent = `Relanzar por ${pointsToGain} Puntos`;
                relaunchButton.classList.add('can-afford-glow');
            } else {
                relaunchButton.classList.add('is-disabled');
                relaunchButton.textContent = 'Relanzar';
                relaunchButton.classList.remove('can-afford-glow');
            }
        
            for (const categoryId in upgrades) {
        		for (const upgradeId in upgrades[categoryId].items) {
        			const cost = calculateUpgradeCost(upgradeId);
        			const buyButton = document.getElementById(`buy-${upgradeId}`);
        			const upgradeContainer = document.getElementById(`upgrade-container-${upgradeId}`);
        			const upgradeInfoDiv = upgradeContainer.querySelector('.upgrade-info');
        
        			if (!buyButton || !upgradeContainer || !upgradeInfoDiv) continue;
        
        			const levelSpan = document.getElementById(`level-${upgradeId}`);
        			if(levelSpan) levelSpan.textContent = gameState.upgradeLevels[upgradeId] || 0;
                
        			const costSpan = document.getElementById(`cost-${upgradeId}`);
        			if(costSpan) costSpan.textContent = formatNumber(cost);
        
        			// Eliminamos el div de requisitos anterior para evitar duplicados
        			const oldReqsDiv = upgradeInfoDiv.querySelector('.requirements-list');
        			if (oldReqsDiv) oldReqsDiv.remove();
        
        			const hurdle = findNextRequirementHurdle(upgradeId);
                
        			if (hurdle) {
        				// --- HAY UN BLOQUEO ACTIVO: Mostramos los requisitos ---
        				upgradeContainer.classList.add('is-locked');
        				buyButton.classList.add('is-disabled');
        				buyButton.classList.remove('can-afford-glow');
        
        				let requirementsHtml = `<div class="requirements-list is-locked-info">`;
        				requirementsHtml += `<p class="unmet">Bloqueado en Nivel ${hurdle.level}</p>`;
        
        				for (const reqId in hurdle.reqs) {
        					// --- LA CORRECCI√ìN EST√Å AQU√ç ---
        					// ANTES: findById(reqId) --> INCORRECTO
        					// AHORA: findUpgradeById(reqId) --> CORRECTO
        					const requiredUpgrade = findUpgradeById(reqId); 
        					const requiredLevel = hurdle.reqs[reqId];
        					const currentReqLevel = gameState.upgradeLevels[reqId] || 0;
        					const isMet = currentReqLevel >= requiredLevel;
        					const statusClass = isMet ? 'met' : 'unmet';
                        
        					// Aseguramos que 'requiredUpgrade' no sea nulo antes de intentar acceder a su nombre
        					if(requiredUpgrade) {
        						requirementsHtml += `
        							<p class="${statusClass}">
        								- ${requiredUpgrade.name} (${currentReqLevel}/${requiredLevel})
        							</p>`;
        					}
        				}
        				requirementsHtml += '</div>';
        				upgradeInfoDiv.insertAdjacentHTML('beforeend', requirementsHtml);
        				buyButton.title = 'Requisitos no cumplidos';
        
        			} else {
        				// --- NO HAY BLOQUEO ACTIVO: La mejora se ve normal ---
        				upgradeContainer.classList.remove('is-locked');
        				const canAfford = gameState.money >= cost;
        				buyButton.classList.toggle('is-disabled', !canAfford);
        				buyButton.classList.toggle('can-afford-glow', canAfford);
        				buyButton.title = '';
        			}
        		}
        	}
        }
        ---------- FIN CONTENIDO ----------

